<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width-device-width, initial-scale=1.0" />
  <title>All Products - Flexshoe</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <style>
    dialog {
            left: 40%;
            top: 20%;
            position: fixed;
            border: none;
            border-radius: 10px;
            padding: 20px;
            width: 300px;
            text-align: center;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
        }
        button {
            margin-top: 10px;
            padding: 8px 15px;
            border: none;
            background: #007bff;
            color: white;
            cursor: pointer;
            border-radius: 5px;
        }
        button:hover {
            background: #0056b3;
        }
  </style>
</head>

<body>
  <dialog id="errorDialog">
    <p id="errorMessage">Error message here</p>
    <button onclick="closeDialog()">Close</button>
</dialog>
  <div class="container">
    <div class="navbar">
      <div class="logo">
        <a href="index.html"><img src="images/logo_shoe.png" width="125px" /></a>
      </div>
      <nav>
        <ul id="MenuItems">
          <li><a href="index.html">Home</a></li>
          <li><a href="products.html">Products</a></li>
          <li><a href="">About</a></li>
          <li><a href="">Contact</a></li>
          <li id="account-link"></li>
          <li id="signout-link" style="display: none;"><a href="#" onclick="signOut()">Sign Out</a></li>
        </ul>
      </nav>
      <a href="cart.html"><img src="images/cart.png" width="30px" height="30px" /></a>
      <img src="images/menu.png" class="menu-icon" onClick="menutoggle()" />
    </div>
  </div>

  <!------------------------------ account-page details------------------------------>

  <div class="account-page">
    <div class="container">
      <div class="row">
        <div class="col-2">
          <img src="images/image1.png" width="100%" />
        </div>
        <div class="col-2">
          <div class="form-container">
            <div class="form-btn">
              <span onclick="login()">Login</span>
              <span onclick="register()">Register</span>
              <hr id="Indicator" />
            </div>

            <form id="LoginForm">
              <input type="text" id="login-username" placeholder="Username" required />
              <input type="password" id="login-password" placeholder="Password" required />
              <button type="submit" class="btn">Login</button>
              <a href="">Forgot password</a>
            </form>

            <form id="RegForm">
              <input type="text" id="register-username" placeholder="Username" autocomplete="additional-name"
                required />
              <input type="email" id="register-email" placeholder="Email" autocomplete="email" required />
              <input type="password" id="register-password" placeholder="Password" required />
              <button type="submit" class="btn">Register</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!----------------------------------footer------------------------------------->
  <div class="footer">
    <div class="container">
      <div class="row">
        <div class="footer-col-1">
          <h3>Download Our App</h3>
          <p>Download App for Android and iOS mobile phone.</p>
          <div class="app-logo">
            <img src="images/play-store.png" alt="" />
            <img src="images/app-store.png" alt="" />
          </div>
        </div>
        <div class="footer-col-2">
          <img src="images/logo_shoe.png" />
          <p>
            Our Purpose Is To Sustainably Make the Pleasure and Benefits of
            Sports Accessible to the Many.
          </p>
        </div>
        <div class="footer-col-3">
          <h3>Useful Links</h3>
          <ul>
            <li>Coupons</li>
            <li>Blog Post</li>
            <li>Return Policy</li>
            <li>Join Affiliate</li>
          </ul>
        </div>
        <div class="footer-col-4">
          <h3>Follow us</h3>
          <ul>
            <li>Facebook</li>
            <li>Twitter</li>
            <li>Instagram</li>
            <li>Youtube</li>
          </ul>
        </div>
      </div>
      <hr />
      <p class="copyright">Copyright 2025 - Shoeb</p>
    </div>
  </div>

  <!----------------------------------- JavaScript -------------------------------------->

  <script>
        function showDialog(message) {
            document.getElementById("errorMessage").textContent = message;
            document.getElementById("errorDialog").showModal();
        }

        function closeDialog() {
            document.getElementById("errorDialog").close();
        }
   function getCookie(name) {
    const cookies = document.cookie.split('; ');
    for (let i = 0; i < cookies.length; i++) {
      const parts = cookies[i].split('=');
      if (parts[0] === name) {
        return decodeURIComponent(parts[1]);
      }
    }
    return null;
  }

function deleteCookie(name) {
    document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
}

deleteCookie("token");

  function updateNavbar() {
    const username = getCookie("username");
    const accountLink = document.getElementById("account-link");
    const signoutLink = document.getElementById("signout-link");

    if (username) {
      accountLink.innerHTML = `<a href="account.html">ðŸ‘¤ ${username}</a>`;
      signoutLink.style.display = "block";
    } else {
      accountLink.innerHTML = `<a href="account.html">Sign In</a>`;
      signoutLink.style.display = "none";
    }
  }

  function signOut() {
    const cookies = document.cookie.split("; ");
    for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].split("=")[0];
        document.cookie = cookie + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
    }
    updateNavbar();
    window.location.href = "account.html";
}

  updateNavbar();
  
    var MenuItems = document.getElementById("MenuItems");
    MenuItems.style.maxHeight = "0px";

    function menutoggle() {
      if (MenuItems.style.maxHeight === "0px") {
        MenuItems.style.maxHeight = "200px";
      } else {
        MenuItems.style.maxHeight = "0px";
      }
    }

    var LoginForm = document.getElementById("LoginForm");
    var RegForm = document.getElementById("RegForm");
    var Indicator = document.getElementById("Indicator");

    function register() {
      RegForm.style.transform = "translateX(0px)";
      LoginForm.style.transform = "translateX(0px)";
      Indicator.style.transform = "translateX(100px)";
    }

    function login() {
      RegForm.style.transform = "translateX(300px)";
      LoginForm.style.transform = "translateX(300px)";
      Indicator.style.transform = "translateX(0px)";
    }

    document.addEventListener("DOMContentLoaded", function () {
      document.getElementById("RegForm").addEventListener("submit", handleRegister);
      document.getElementById("LoginForm").addEventListener("submit", handleLogin);
    });

    function setCookie(name, value, days) {
      let expires = "";
      if (days) {
        let date = new Date();
        date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = `${name}=${value}; path=/; Secure; SameSite=Lax${expires}`;
    }



    async function handleRegister(event) {
      event.preventDefault();
      const username = document.getElementById("register-username").value;
      const email = document.getElementById("register-email").value;
      const password = document.getElementById("register-password").value;

      try {
        const response = await fetch("https://flex-store-db.onrender.com/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name: username, email: email, password: password })
        });

        const data = await response.json();
        if (response.ok) {
          setCookie("username", data.name, 30);
          setCookie("token", data.token, 30);
          showDialog("Registration successful! You can now log in.");
        } else {
          showDialog(data.message || "Registration failed");
        }
      } catch (error) {
        console.error("Registration error:", error);
        showDialog("Something went wrong. Try again later.");
      }
    }

    async function handleLogin(event) {
      event.preventDefault();
      const email = document.getElementById("login-username").value;
      const password = document.getElementById("login-password").value;

      try {
        const response = await fetch("https://flex-store-db.onrender.com/login", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ email: email, password: password })
        });

        const text = await response.text();
        let data;
        try {
          data = JSON.parse(text);
        } catch (error) {
          console.error("Invalid JSON response:", text);
          showDialog(text);
          return;
        }

        if (response.ok) {
          setCookie("token", data.token, 30);
          setCookie("username", data.name, 30);
          showDialog("Login successful!");
          window.location.href = "index.html";
        } else {
          showDialog(data.message || "Login failed");
        }
      } catch (error) {
        console.error("Login error:", error);
        showDialog("Something went wrong. Try again later.");
      }
    }

  </script>
</body>

</html>